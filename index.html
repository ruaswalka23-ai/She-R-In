<script>
  (function() {
    const htmlElement = document.documentElement;
    const themeToggle = document.getElementById('themeToggle');
    const moonIcon = document.getElementById('moon-icon');
    const sunIcon = document.getElementById('sun-icon');
    const langSelect = document.getElementById('langSelect');

    // --- Theme Toggle Functionality ---
    function applyTheme(theme) {
      htmlElement.setAttribute('data-theme', theme);
      if (theme === 'light') {
        moonIcon.style.display = 'none';
        sunIcon.style.display = 'block';
      } else {
        moonIcon.style.display = 'block';
        sunIcon.style.display = 'none';
      }
      localStorage.setItem('theme', theme);
    }

    themeToggle.addEventListener('click', () => {
      const currentTheme = htmlElement.getAttribute('data-theme') || 'dark';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      applyTheme(newTheme);
    });

    // Initialize theme from localStorage
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      applyTheme(savedTheme);
    } else {
      // Default to dark if no theme is saved
      applyTheme('dark');
    }

    // --- Language Toggle Functionality ---
    const TR = { // Your existing translations object
      ar: {
        nav_policy:'سياستنا', nav_services:'خدماتنا', nav_platforms:'المنصّات', nav_contact:'اتصل بنا',
        hero_tag:'ابحث، قارن، اختر.. بكل سهولة', hero_title:'هي بوابة دخولك إلى السوق الصينية', hero_desc:'نقدّم خدمات شحن شاملة: البحث عن المنتجات، المقارنة بين المورّدين، الإشراف على الشراء، التخليص الجمركي، والشحن إلى أي مكان في العالم—بحلول مخصّصة تناسب مشروعك.',
        cta_book:'احجز الآن', cta_services:'تعرّف على الخدمات',
        about_title:'سياستنا', about_text:'نلتزم بالأمان والشفافية: سند قبض للدفعة الأولى وإثبات شراء، مع إمكانيّة تتبّع طلبك في أي وقت. عادةً يصل الطلب خلال <strong>45–60 يومًا</strong> من تاريخ إغلاق الحاوية.',
        services_title:'خدماتنا',
        shipping_header: 'كل ما يهمك عن الشحن معنا',
        shipping_list: '<li>نقوم بالشحن من **أي مكان في الصين** إلى الأردن.</li><li>نقوم باستلام الشحنات من المورّدين في الصين، ودمجها مع بعضها في حاويات شحن.</li><li>سواء كان لديك شحنة صغيرة أو كبيرة، نقوم بتجهيزها للشحن البحري أو الجوي.</li><li>نحن نتكفل بجميع إجراءات التخليص الجمركي في الأردن، ونقوم بتسليم الشحنة في عنوانك.</li><li>نضمن التوصيل إلى **جميع المحافظات** في الأردن.</li>',
        experts_header: 'خبراء اختيار المنتج',
        experts_list: '<li>من خبرتنا الواسعة، نساعدك في **اختيار أفضل المنتجات** من بين مئات الموردين.</li><li>نضمن لك تحقيق الجودة المطلوبة لمنتجك، ونتأكد من أن السعر يناسب ميزانيتك.</li><li>فريقنا يقوم بالبحث والتفاوض مع الموردين نيابة عنك.</li>',
        safety_header: 'الأمان والشفافية',
        safety_list: '<li>يتم تسليمك **سند قبض** رسمي بقيمة الدفعة الأولى التي قمت بدفعها.</li><li>نقدم لك **إثباتات شراء** كاملة لضمان الشفافية التامة.</li><li>يمكنك **تتبع طلبك** في أي وقت من خلال فريقنا المختص.</li>',
        local_platforms_title: 'استيرادك من المنصّات الصينية المحلية',
        platforms_title:'المنصّات التي نغطيها', guides_title:'كل ما تود معرفته عن علي بابا وعلي اكسبريس',
        contact_title:'اتصل بنا', kpi_title:'أرقام سريعة',
        eta_label:'موعد أقرب حاوية',
        contact_addr:'العنوان: AVT, Rae\'d Khalaf Complex, Sweifieh – Amman',
        contact_hours:'ساعات العمل: الأحد–الخميس 09:00–21:00 • الجمعة–السبت: مغلق',
        form_send:'إرسال', form_whatsapp:'مراسلة عبر واتساب',
        calculator_title: 'حاسبة السعر',
        calc_price_label: 'سعر المنتج بالدولار ($):', calc_price_placeholder: 'أدخل السعر بالدولار',
        calc_internal_fee_label: 'رسوم النقل الداخلي ($):', calc_internal_fee_placeholder: 'أدخل رسوم النقل',
        calc_size_label: 'حجم المنتج (بالمتر المكعب):', calc_size_placeholder: 'أدخل الحجم بالمتر المكعب',
        calc_button: 'احسب السعر',
        calc_result_prefix: '💰 السعر النهائي: ', calc_result_suffix: ' دينار أردني'
      },
      en: {
        nav_policy:'Policy', nav_services:'Services', nav_platforms:'Platforms', nav_contact:'Contact',
        hero_tag:'Search. Compare. Choose—easily.', hero_title:'Your gateway to the Chinese market', hero_desc:'We provide end-to-end shipping: sourcing, supplier comparison, purchase supervision, customs clearance, and worldwide delivery—tailored to your business.',
        cta_book:'Book Now', cta_services:'Explore Services',
        about_title:'Our Policy', about_text:'We commit to safety and transparency: official receipt for the deposit and proof of purchase, plus full order tracking. Typical arrival: 45–60 days from container closing.',
        services_title:'Our Services',
        shipping_header: 'All You Need to Know About Shipping with Us',
        shipping_list: '<li>We ship from **anywhere in China** to Jordan.</li><li>We receive shipments from suppliers in China and consolidate them into shipping containers.</li><li>Whether you have a small or large shipment, we prepare it for sea or air freight.</li><li>We handle all customs clearance procedures in Jordan and deliver the shipment to your address.</li><li>We guarantee delivery to **all governorates** in Jordan.</li>',
        experts_header: 'Product Selection Experts',
        experts_list: '<li>With our extensive experience, we help you **choose the best products** from hundreds of suppliers.</li><li>We ensure your product meets the required quality and fits your budget.</li><li>Our team researches and negotiates with suppliers on your behalf.</li>',
        safety_header: 'Safety and Transparency',
        safety_list: '<li>You will receive an official **receipt** for your initial deposit.</li><li>We provide complete **proof of purchase** for full transparency.</li><li>You can **track your order** at any time through our specialized team.</li>',
        local_platforms_title: 'Importing from Local Chinese Platforms',
        platforms_title:'Platforms We Cover', guides_title:'All You Need to Know About Alibaba & AliExpress',
        contact_title:'Contact Us', kpi_title:'Quick Numbers',
        eta_label:'Next Container ETA',
        contact_addr:'Address: AVT, Rae\'d Khalaf Complex, Sweifieh – Amman',
        contact_hours:'Working Hours: Sun-Thu 09:00-21:00 • Fri-Sat: Closed',
        form_send:'Send', form_whatsapp:'WhatsApp Message',
        calculator_title: 'Price Calculator',
        calc_price_label: 'Product Price in USD ($):', calc_price_placeholder: 'Enter price in USD',
        calc_internal_fee_label: 'Internal Shipping Fee ($):', calc_internal_fee_placeholder: 'Enter shipping fee',
        calc_size_label: 'Product Size (m³):', calc_size_placeholder: 'Enter volume in m³',
        calc_button: 'Calculate Price',
        calc_result_prefix: '💰 Final Price: ', calc_result_suffix: ' Jordanian Dinar'
      },
      zh: {
        nav_policy:'政策', nav_services:'服务', nav_platforms:'平台', nav_contact:'联系我们',
        hero_tag:'搜索. 比较. 选择 — 轻而易举', hero_title:'您的中国市场入口', hero_desc:'我们提供端到端运输服务：采购、供应商比较、采购监督、清关和全球配送 — 量身定制您的业务。',
        cta_book:'立即预订', cta_services:'了解服务',
        about_title:'我们的政策', about_text:'我们致力于安全与透明：提供押金收据和购买证明，并可全程追踪订单。通常在集装箱封箱日期后 45-60 天送达。',
        services_title:'我们的服务',
        shipping_header: '您需要了解的关于我们运输的所有信息',
        shipping_list: '<li>我们从**中国任何地方**运往约旦。</li><li>我们接收来自中国供应商的货物，并将它们整合到集装箱中。</li><li>无论您有小批量还是大批量货物，我们都能为您准备海运或空运。</li><li>我们处理约旦的所有清关手续，并将货物运送到您的地址。</li><li>我们保证送达约旦**所有省份**。</li>',
        experts_header: '选品专家',
        experts_list: '<li>凭借我们丰富的经验，我们帮助您从数百家供应商中**选择最佳产品**。</li><li>我们确保您的产品符合要求的质量并符合您的预算。</li><li>我们的团队将代表您研究和协商供应商。</li>',
        safety_header: '安全与透明',
        safety_list: '<li>您将收到一份正式的**押金收据**。</li><li>我们提供完整的**购买证明**以确保完全透明。</li><li>您可以通过我们的专业团队随时**追踪您的订单**。</li>',
        local_platforms_title: '从本地中国平台进口',
        platforms_title:'我们覆盖的平台', guides_title:'您需要了解的关于阿里巴巴和速卖通的一切',
        contact_title:'联系我们', kpi_title:'快速数据',
        eta_label:'下一集装箱预计到达时间',
        contact_addr:'地址：AVT, Rae\'d Khalaf Complex, Sweifieh – Amman',
        contact_hours:'工作时间：周日至周四 09:00–21:00 • 周五至周六：休息',
        form_send:'发送', form_whatsapp:'WhatsApp 消息',
        calculator_title: '价格计算器',
        calc_price_label: '产品价格（美元）：', calc_price_placeholder: '输入美元价格',
        calc_internal_fee_label: '境内运费（美元）：', calc_internal_fee_placeholder: '输入运费',
        calc_size_label: '产品体积（立方米）：', calc_size_placeholder: '输入体积（立方米）',
        calc_button: '计算价格',
        calc_result_prefix: '💰 最终价格： ', calc_result_suffix: ' 约旦第纳尔'
      }
    };

    function updateContent(lang) {
      const elementsToTranslate = document.querySelectorAll('[id]');
      elementsToTranslate.forEach(el => {
        const id = el.id;
        if (TR[lang] && TR[lang][id]) {
          // Special handling for list items and structured content
          if (el.tagName === 'LI') {
            // Assuming list items are within sections that have a corresponding key in TR
            // This part might need more specific selectors if LI elements are used in multiple contexts
            const parentKey = Object.keys(TR[lang]).find(key => TR[lang][key].includes('<li>'));
            if (parentKey) {
              const listItems = TR[lang][parentKey].split('</li>').filter(item => item.trim() !== '');
              let itemIndex = 0;
              el.parentNode.querySelectorAll('li').forEach(li => {
                if (listItems[itemIndex]) {
                  li.innerHTML = listItems[itemIndex].replace(/<\/?strong>/g, '').replace(/<\/?em>/g, '').trim(); // Remove bold/italic tags from translated text for direct assignment
                  itemIndex++;
                }
              });
              return; // Skip further processing for LI elements to avoid overwriting
            }
          }
          
          // General text content update
          if (el.tagName === 'H1' || el.tagName === 'H2' || el.tagName === 'H3' || el.tagName === 'H4' || el.tagName === 'SPAN' || el.tagName === 'LABEL' || el.tagName === 'BUTTON' || el.tagName === 'A' || el.tagName === 'P' || el.tagName === 'STRONG' || el.tagName === 'LI' || el.tagName === 'DIV' && el.classList.contains('tag') || el.tagName === 'DIV' && el.classList.contains('date') || el.tagName === 'DIV' && el.classList.contains('num') || el.tagName === 'DIV' && el.classList.contains('muted') || el.tagName === 'DIV' && el.classList.contains('kpi') || el.tagName === 'DIV' && el.classList.contains('product') || el.tagName === 'DIV' && el.classList.contains('banner') || el.tagName === 'DIV' && el.classList.contains('tabs-header') || el.tagName === 'DIV' && el.classList.contains('tab-btn') || el.tagName === 'DIV' && el.classList.contains('tab-pane') || el.tagName === 'DIV' && el.classList.contains('tab-actions') || el.tagName === 'DIV' && el.classList.contains('calculator') || el.tagName === 'DIV' && el.classList.contains('row')) {
            // Preserve HTML for elements like 'about_text' or 'hero_desc' that contain bold/strong tags
            if (typeof TR[lang][id] === 'string' && TR[lang][id].includes('<strong>') || TR[lang][id].includes('<em>') || TR[lang][id].includes('<b>') || TR[lang][id].includes('<i>')) {
              el.innerHTML = TR[lang][id];
            } else {
              el.textContent = TR[lang][id];
            }
          } else if (el.tagName === 'INPUT' && el.placeholder) {
            el.placeholder = TR[lang][id + '_placeholder'] || el.placeholder;
          } else if (el.tagName === 'SELECT') {
            // For select, update the options if they are translatable, otherwise assume they are already handled or static.
            // This part is simplified; a more robust solution would involve mapping select options to translations.
            // For now, we assume the options themselves are static or handled by initial HTML.
          } else if (el.tagName === 'OPTION') {
            // This is a fallback if you had translatable options in your HTML
            if (TR[lang][id]) {
              el.textContent = TR[lang][id];
            }
          }
        }
      });
      // Update dir and lang attributes
      htmlElement.lang = lang;
      htmlElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
      localStorage.setItem('lang', lang);
    }

    langSelect.addEventListener('change', (e) => {
      updateContent(e.target.value);
    });

    // Initialize language from localStorage or default to 'ar'
    const savedLang = localStorage.getItem('lang') || 'ar';
    langSelect.value = savedLang;
    updateContent(savedLang);

    // Initialize current year
    document.getElementById('year').textContent = new Date().getFullYear();

    // --- Calculator Functionality ---
    const calculatorTitle = document.getElementById('calculator_title');
    const calcPriceLabel = document.getElementById('price'); // Assuming you meant to get the input by ID
    const calcPricePlaceholder = document.getElementById('price');
    const calcInternalFeeLabel = document.getElementById('internalFee');
    const calcInternalFeePlaceholder = document.getElementById('internalFee');
    const calcSizeLabel = document.getElementById('size');
    const calcSizePlaceholder = document.getElementById('size');
    const calculateButton = document.getElementById('calculate_button');
    const resultDisplay = document.getElementById('result');

    function updateCalculatorLabels(lang) {
        if (TR[lang]) {
            calculatorTitle.textContent = TR[lang].calculator_title;
            document.querySelector('label[for="price"]').textContent = TR[lang].calc_price_label;
            calcPricePlaceholder.placeholder = TR[lang].calc_price_placeholder;
            document.querySelector('label[for="internalFee"]').textContent = TR[lang].calc_internal_fee_label;
            calcInternalFeePlaceholder.placeholder = TR[lang].calc_internal_fee_placeholder;
            document.querySelector('label[for="size"]').textContent = TR[lang].calc_size_label;
            calcSizePlaceholder.placeholder = TR[lang].calc_size_placeholder;
            calculateButton.textContent = TR[lang].calc_button;
        }
    }

    // Update calculator labels on language change
    langSelect.addEventListener('change', (e) => {
      updateContent(e.target.value);
      updateCalculatorLabels(e.target.value);
    });

    // Initial update for calculator labels
    updateCalculatorLabels(savedLang);

    function calculatePrice() {
      const priceUSD = parseFloat(document.getElementById('price').value);
      const internalFeeUSD = parseFloat(document.getElementById('internalFee').value);
      const sizeCBM = parseFloat(document.getElementById('size').value);
      const resultElement = document.getElementById('result');
      const lang = localStorage.getItem('lang') || 'ar'; // Get current language

      if (isNaN(priceUSD) || isNaN(internalFeeUSD) || isNaN(sizeCBM)) {
        resultElement.textContent = 'Please enter valid numbers.';
        return;
      }

      // Assuming a simplified calculation: Product Price + Internal Fee + (Size * Rate)
      // You'll need to define the rate per cubic meter (e.g., $50/CBM)
      const ratePerCBM = 50; // Example rate, adjust as needed
      const totalUSD = priceUSD + internalFeeUSD + (sizeCBM * ratePerCBM);

      // For simplicity, let's assume a fixed exchange rate for now.
      // In a real-world scenario, you'd fetch this or have a dynamic conversion.
      const JOD_per_USD = 0.709; // Example rate, approx. as of current knowledge
      const totalJOD = totalUSD * JOD_per_USD;

      // Use the translated prefix and suffix
      resultElement.innerHTML = `${TR[lang].calc_result_prefix}${totalJOD.toFixed(2)}${TR[lang].calc_result_suffix}`;
    }

    // Attach the calculator function to the button
    window.calculatePrice = calculatePrice; // Make it globally accessible if needed, or directly attach to button if not using inline onclick


    // --- Tab Functionality ---
    const tabButtons = document.querySelectorAll('.tab-btn');
    const tabPanes = document.querySelectorAll('.tab-pane');

    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Remove active class from all buttons and panes
        tabButtons.forEach(btn => btn.classList.remove('active'));
        tabPanes.forEach(pane => pane.classList.remove('active'));

        // Add active class to the clicked button and its corresponding pane
        button.classList.add('active');
        document.getElementById(`tab-${button.getAttribute('data-tab')}`).classList.add('active');
      });
    });

    // --- Handle Form Submission ---
    function handleFormSubmit(event) {
      event.preventDefault(); // Prevent default form submission
      const nameInput = document.getElementById('input_name');
      const phoneInput = document.getElementById('input_phone');
      const msgInput = document.getElementById('input_msg');

      const name = nameInput.value;
      const phone = phoneInput.value;
      const message = msgInput.value;

      // Construct WhatsApp message
      const lang = localStorage.getItem('lang') || 'ar'; // Get current language
      let whatsappMessage = '';

      if (lang === 'ar') {
          whatsappMessage = `اسم: ${name}\nرقم واتساب: ${phone}\nالرسالة: ${message}`;
      } else if (lang === 'en') {
          whatsappMessage = `Name: ${name}\nWhatsApp Number: ${phone}\nMessage: ${message}`;
      } else { // zh
          whatsappMessage = `姓名: ${name}\nWhatsApp号码: ${phone}\n消息: ${message}`;
      }


      // Encode the message for URL
      const encodedMessage = encodeURIComponent(whatsappMessage);
      const whatsappUrl = `https://wa.me/+962782706724?text=${encodedMessage}`;

      // Open WhatsApp in a new tab
      window.open(whatsappUrl, '_blank');

      // Optionally clear the form
      nameInput.value = '';
      phoneInput.value = '';
      msgInput.value = '';

      // You might want to show a success message or redirect
      alert("تم إرسال رسالتك عبر واتساب!"); // Simple confirmation
      return false; // Prevent form from actually submitting
    }
    window.handleFormSubmit = handleFormSubmit; // Make it globally accessible

  })();
</script>
